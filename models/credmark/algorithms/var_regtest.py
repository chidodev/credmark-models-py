import credmark.model
from credmark.model import ModelRunError
from credmark.dto import EmptyInput

import numpy as np

TEST_CASE = {
    'AAVE+WETH (39 days)': {
        'input': {"portfolio": {"positions": [{"amount":  1, "asset": {"symbol": "WETH"}}, {"amount":  1, "asset": {"symbol": "AAVE"}}]}, "window": "39 days", "intervals": [
            "1 day", "2 day", "5 day", "10 day", "12 days"], "asOfs": ["2022-02-17", "2022-02-05"], "asOf_is_range": True, "confidences": [0, 0.01, 0.05, 1.0], "dev_mode": True},
        'output': {'window': '39 days', 'var': {'2022-02-17': {'1 day': {'0.0': -480.0407359059778, '0.01': -382.70025766953887, '0.05': -185.7988873004568, '1.0': 365.3175463905925}, '2 day': {'0.0': -671.9703128795722, '0.01': -637.2622428115994, '0.05': -368.2133897965158, '1.0': 406.1841563651847}, '5 day': {'0.0': -859.6296888076787, '0.01': -838.878412182416, '0.05': -743.6607170498957, '1.0': 586.2546926890967}, '10 day': {'0.0': -975.5430342460205, '0.01': -955.6521471286546, '0.05': -903.7018572322377, '1.0': 869.0050951209131}, '12 days': {'0.0': -937.4090587193575, '0.01': -936.9767008195497, '0.05': -911.798768366273, '1.0': 961.5937230843324}}, '2022-02-16': {'1 day': {'0.0': -480.0407359059778, '0.01': -382.70025766953887, '0.05': -185.7988873004568, '1.0': 365.3175463905925}, '2 day': {'0.0': -671.9703128795722, '0.01': -637.2622428115994, '0.05': -368.2133897965158, '1.0': 406.1841563651847}, '5 day': {'0.0': -859.6296888076787, '0.01': -838.878412182416, '0.05': -743.6607170498957, '1.0': 586.2546926890967}, '10 day': {'0.0': -975.5430342460205, '0.01': -955.6521471286546, '0.05': -903.7018572322377, '1.0': 869.0050951209131}, '12 days': {'0.0': -937.4090587193575, '0.01': -936.9767008195497, '0.05': -911.798768366273, '1.0': 961.5937230843324}}, '2022-02-15': {'1 day': {'0.0': -480.0407359059778, '0.01': -382.70025766953887, '0.05': -185.7988873004568, '1.0': 365.3175463905925}, '2 day': {'0.0': -671.9703128795722, '0.01': -637.2622428115994, '0.05': -368.2133897965158, '1.0': 406.1841563651847}, '5 day': {'0.0': -859.6296888076787, '0.01': -838.878412182416, '0.05': -743.6607170498957, '1.0': 586.2546926890967}, '10 day': {'0.0': -975.5430342460205, '0.01': -955.6521471286546, '0.05': -903.7018572322377, '1.0': 869.0050951209131}, '12 days': {'0.0': -937.4090587193575, '0.01': -936.9767008195497, '0.05': -911.798768366273, '1.0': 961.5937230843324}}, '2022-02-14': {'1 day': {'0.0': -442.280038142135, '0.01': -352.6988938163395, '0.05': -203.92554480447453, '1.0': 336.46705798050795}, '2 day': {'0.0': -619.3455884940166, '0.01': -587.3076251725138, '0.05': -339.3656877514791, '1.0': 374.15365963465354}, '5 day': {'0.0': -792.3971403523565, '0.01': -773.2337435542203, '0.05': -685.4099475378906, '1.0': 540.1493360398961}, '10 day': {'0.0': -898.9914315044928, '0.01': -880.7536194334191, '0.05': -833.0799818862577, '1.0': 800.4081695716384}, '12 days': {'0.0': -864.1305421942614, '0.01': -863.6463878849329, '0.05': -840.280181252331, '1.0': 885.9161961556196}}, '2022-02-13': {'1 day': {'0.0': -433.75440425306715, '0.01': -345.8915437649949, '0.05': -199.99467116352682, '1.0': 329.9906393000336}, '2 day': {'0.0': -607.3872909006627, '0.01': -575.971915173728, '0.05': -334.07195224440034, '1.0': 366.94788869335906}, '5 day': {'0.0': -777.0901958635166, '0.01': -758.2999066710315, '0.05': -672.1770549133125, '1.0': 529.7362626578866}, '10 day': {'0.0': -881.6464768179956, '0.01': -863.7528585609184, '0.05': -816.9823587381188, '1.0': 784.9990356654666}, '12 days': {'0.0': -847.4348032795322, '0.01': -846.9671315581068, '0.05': -824.0654105340857, '1.0': 868.8418846934203}}, '2022-02-12': {'1 day': {'0.0': -439.8333806833247, '0.01': -350.7993677326416, '0.05': -204.40742095179095, '1.0': 334.54828467128334}, '2 day': {'0.0': -616.0370008011404, '0.01': -584.1460057924221, '0.05': -340.21801147554993, '1.0': 372.04384472138895}, '5 day': {'0.0': -788.2086828835903, '0.01': -769.128908679891, '0.05': -681.7425590550022, '1.0': 537.166453900969}, '10 day': {'0.0': -894.1119848288267, '0.01': -876.0196056805245, '0.05': -828.7054845073653, '1.0': 795.8596216273855}, '12 days': {'0.0': -859.5816643716172, '0.01': -859.0569666940344, '0.05': -835.7349900509956, '1.0': 880.9966535291798}}, '2022-02-11': {'1 day': {'0.0': -442.17952013214136, '0.01': -352.728834880522, '0.05': -205.55682140428388, '1.0': 336.2679172123987}, '2 day': {'0.0': -619.4558333298858, '0.01': -587.3605480519506, '0.05': -342.07892773606375, '1.0': 373.9831782242554}, '5 day': {'0.0': -792.6333626683364,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                '0.01': -773.4265295422928, '0.05': -685.519399091331, '1.0': 540.0376336984777}, '10 day': {'0.0': -898.9871418263455, '0.01': -880.8485611889056, '0.05': -833.3902427239819, '1.0': 799.9684816335736}, '12 days': {'0.0': -864.4281718065231, '0.01': -863.8518613309061, '0.05': -840.309449922952, '1.0': 885.6748776502958}}, '2022-02-10': {'1 day': {'0.0': -464.05914973812776, '0.01': -370.2540139778239, '0.05': -215.80073159785937, '1.0': 352.8270265227455}, '2 day': {'0.0': -650.2707645211018, '0.01': -616.5452974367846, '0.05': -359.06223337080803, '1.0': 392.43272630847935}, '5 day': {'0.0': -832.1249827499688, '0.01': -811.9366519437501, '0.05': -719.6125029909579, '1.0': 566.7666131674067}, '10 day': {'0.0': -943.6004599352516, '0.01': -924.626270943866, '0.05': -874.9527955879528, '1.0': 839.3841400668252}, '12 days': {'0.0': -907.5228930689577, '0.01': -906.8579896347196, '0.05': -882.0324802738431, '1.0': 929.4732181992737}}, '2022-02-09': {'1 day': {'0.0': -490.62249763018633, '0.01': -391.56862188433433, '0.05': -228.27591419831194, '1.0': 372.88872391521807}, '2 day': {'0.0': -687.7684781484123, '0.01': -652.0416468949295, '0.05': -379.7111009107637, '1.0': 414.8023433984876}, '5 day': {'0.0': -880.2136223352967, '0.01': -858.8172542612356, '0.05': -761.0950295595094, '1.0': 599.221201709577}, '10 day': {'0.0': -997.8328184281913, '0.01': -977.8768392531674, '0.05': -925.5843242213732, '1.0': 887.1487763457583}, '12 days': {'0.0': -960.012660927301, '0.01': -959.2084746045455, '0.05': -932.7627849917747, '1.0': 982.6336165049206}}, '2022-02-08': {'1 day': {'0.0': -472.7999702966495, '0.01': -377.38662804474615, '0.05': -220.0263375611738, '1.0': 359.2959422091179}, '2 day': {'0.0': -662.8807163345261, '0.01': -628.4269095240239, '0.05': -365.95106145358636, '1.0': 399.70128308130853}, '5 day': {'0.0': -848.3984910654409, '0.01': -827.7610279105629, '0.05': -733.5490409094069, '1.0': 577.4579246335493}, '10 day': {'0.0': -961.6619784306176, '0.01': -942.4674308483336, '0.05': -892.1530135672567, '1.0': 854.8229339639882}, '12 days': {'0.0': -925.3285543051609, '0.01': -924.5181602480528, '0.05': -898.9634626506482, '1.0': 946.9227722079486}}, '2022-02-07': {'1 day': {'0.0': -475.81111294210655, '0.01': -379.6730578984042, '0.05': -221.30895081457766, '1.0': 361.71462099323577}, '2 day': {'0.0': -666.8355859175034, '0.01': -632.231032787487, '0.05': -368.1889923515954, '1.0': 402.33771902277005}, '5 day': {'0.0': -853.3591342482405, '0.01': -832.6410446980816, '0.05': -737.938860061503, '1.0': 581.1238504484566}, '10 day': {'0.0': -967.5739064570784, '0.01': -948.1560251303326, '0.05': -897.3037764469104, '1.0': 860.541132413362}, '12 days': {'0.0': -930.6965299125011, '0.01': -929.9790649141719, '0.05': -904.4545888745429, '1.0': 908.0625323462758}}, '2022-02-06': {'1 day': {'0.0': -462.5865010898016, '0.01': -368.99059400951694, '0.05': -215.02622379030586, '1.0': 351.80591563273043}, '2 day': {'0.0': -648.0055353492778, '0.01': -614.4389946475069, '0.05': -357.85271638220337, '1.0': 391.25602457462486}, '5 day': {'0.0': -829.149849602805, '0.01': -809.0639799873637, '0.05': -717.1157989607829, '1.0': 489.24773264427915}, '10 day': {'0.0': -940.4453320944995, '0.01': -921.4549642562744, '0.05': -871.7748422051516, '1.0': 836.9275285016726}, '12 days': {'0.0': -904.246059843632, '0.01': -903.6573923024449, '0.05': -879.0564922185195, '1.0': 774.0744062882357}}, '2022-02-05': {'1 day': {'0.0': -455.7403816727309, '0.01': -363.52389918556025, '0.05': -211.83806793271026, '1.0': 346.60573061698534}, '2 day': {'0.0': -638.4021418194309, '0.01': -605.3357553982742, '0.05': -352.5520560928375, '1.0': 385.47004344021474}, '5 day': {'0.0': -816.8569314920588, '0.01': -797.0708270383576, '0.05': -706.4888532509572, '1.0': 482.0083945507587}, '10 day': {'0.0': -926.5165993051927, '0.01': -907.8023057634437, '0.05': -858.8467301499184, '1.0': 698.9243325892651}, '12 days': {'0.0': -890.8376767966707, '0.01': -890.2625502715008, '0.05': -866.0352349314462, '1.0': 732.8052862929452}}}}
    },
    'AAVE+WETH (90 days)': {
        'input': {"portfolio": {"positions": [{"amount":  1, "asset": {"symbol": "WETH"}}, {"amount":  1, "asset": {"symbol": "AAVE"}}]}, "window": "90 days", "intervals": [
            "1 day", "2 day", "5 day", "10 day", "12 days"], "asOfs": ["2022-02-17", "2022-02-05"], "asOf_is_range": True, "confidences": [0, 0.01, 0.05, 1.0], "dev_mode": True},
        'output': {'window': '90 days', 'var': {'2022-02-17': {'1 day': {'0.0': -480.0407359059778, '0.01': -372.98136505903585, '0.05': -228.97948827332604, '1.0': 365.3175463905925}, '2 day': {'0.0': -671.9703128795722, '0.01': -589.4213894746641, '0.05': -333.978146295698, '1.0': 406.1841563651847}, '5 day': {'0.0': -859.6296888076787, '0.01': -807.751497244522, '0.05': -606.6787965586536, '1.0': 586.2546926890967}, '10 day': {'0.0': -975.5430342460205, '0.01': -920.6716215084595, '0.05': -838.4714030258093, '1.0': 869.0050951209131}, '12 days': {'0.0': -937.4090587193575, '0.01': -936.1600247865794, '0.05': -818.2497214793698, '1.0': 961.5937230843324}}, '2022-02-16': {'1 day': {'0.0': -480.0407359059778, '0.01': -372.98136505903585, '0.05': -228.97948827332604, '1.0': 365.3175463905925}, '2 day': {'0.0': -671.9703128795722, '0.01': -589.4213894746641, '0.05': -333.978146295698, '1.0': 406.1841563651847}, '5 day': {'0.0': -859.6296888076787, '0.01': -807.751497244522, '0.05': -606.6787965586536, '1.0': 586.2546926890967}, '10 day': {'0.0': -975.5430342460205, '0.01': -920.6716215084595, '0.05': -838.4714030258093, '1.0': 869.0050951209131}, '12 days': {'0.0': -937.4090587193575, '0.01': -936.1600247865794, '0.05': -818.2497214793698, '1.0': 961.5937230843324}}, '2022-02-15': {'1 day': {'0.0': -480.0407359059778, '0.01': -372.98136505903585, '0.05': -228.97948827332604, '1.0': 365.3175463905925}, '2 day': {'0.0': -671.9703128795722, '0.01': -589.4213894746641, '0.05': -333.978146295698, '1.0': 406.1841563651847}, '5 day': {'0.0': -859.6296888076787, '0.01': -807.751497244522, '0.05': -606.6787965586536, '1.0': 586.2546926890967}, '10 day': {'0.0': -975.5430342460205, '0.01': -920.6716215084595, '0.05': -838.4714030258093, '1.0': 869.0050951209131}, '12 days': {'0.0': -937.4090587193575, '0.01': -936.1600247865794, '0.05': -818.2497214793698, '1.0': 961.5937230843324}}, '2022-02-14': {'1 day': {'0.0': -442.280038142135, '0.01': -343.6676019806918, '0.05': -211.1104686342411, '1.0': 336.46705798050795}, '2 day': {'0.0': -619.3455884940166, '0.01': -543.1471892428746, '0.05': -307.7447203405131, '1.0': 374.15365963465354}, '5 day': {'0.0': -792.3971403523565, '0.01': -744.4886483570162, '0.05': -559.1758965917023, '1.0': 540.1493360398961}, '10 day': {'0.0': -898.9914315044928, '0.01': -848.6802257911866, '0.05': -772.9532209044451, '1.0': 800.4081695716384}, '12 days': {'0.0': -864.1305421942614, '0.01': -862.7318741895349, '0.05': -754.1025575567354, '1.0': 885.9161961556196}}, '2022-02-13': {'1 day': {'0.0': -433.75440425306715, '0.01': -337.0407518532608, '0.05': -214.22559811997718, '1.0': 329.9906393000336}, '2 day': {'0.0': -607.3872909006627, '0.01': -532.6696405230882, '0.05': -301.8093156309186, '1.0': 366.94788869335906}, '5 day': {'0.0': -777.0901958635166, '0.01': -730.1144728823039, '0.05': -548.3786380797794, '1.0': 529.7362626578866}, '10 day': {'0.0': -881.6464768179956, '0.01': -832.2847712812312, '0.05': -758.0169198224379, '1.0': 784.9990356654666}, '12 days': {'0.0': -847.4348032795322, '0.01': -846.0837516398589, '0.05': -739.5479343427487, '1.0': 868.8418846934203}}, '2022-02-12': {'1 day': {'0.0': -439.8333806833247, '0.01': -341.7793001332797, '0.05': -217.29362858932257, '1.0': 334.54828467128334}, '2 day': {'0.0': -616.0370008011404, '0.01': -540.1881478074321, '0.05': -306.06133038106304, '1.0': 372.04384472138895}, '5 day': {'0.0': -788.2086828835903, '0.01': -740.5092473743421, '0.05': -556.1930601455176, '1.0': 537.166453900969}, '10 day': {'0.0': -894.1119848288267, '0.01': -844.2019733852344, '0.05': -768.8975238278418, '1.0': 795.8596216273855}, '12 days': {'0.0': -859.5816643716172, '0.01': -858.0658710808225, '0.05': -750.0405012386815, '1.0': 880.9966535291798}}, '2022-02-11': {'1 day': {'0.0': -442.17952013214136, '0.01': -343.61690476046135, '0.05': -218.51625248491288, '1.0': 336.2679172123987}, '2 day': {'0.0': -619.4558333298858, '0.01': -543.1211007769588, '0.05': -307.7154000537179, '1.0': 373.9831782242554}, '5 day': {'0.0': -792.6333626683364,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     '0.01': -744.6162798532273, '0.05': -559.284654199748, '1.0': 540.0376336984777}, '10 day': {'0.0': -898.9871418263455, '0.01': -848.9496779989253, '0.05': -773.2476534071748, '1.0': 799.9684816335736}, '12 days': {'0.0': -864.4281718065231, '0.01': -862.7632748769631, '0.05': -754.1650896577187, '1.0': 885.6748776502958}}, '2022-02-10': {'1 day': {'0.0': -464.05914973812776, '0.01': -360.6373718116783, '0.05': -229.40693405059878, '1.0': 352.8270265227455}, '2 day': {'0.0': -650.2707645211018, '0.01': -570.05884280705, '0.05': -322.96801601890945, '1.0': 392.43272630847935}, '5 day': {'0.0': -832.1249827499688, '0.01': -781.6541557344225, '0.05': -587.1123632109735, '1.0': 566.7666131674067}, '10 day': {'0.0': -943.6004599352516, '0.01': -891.257869614188, '0.05': -811.8150673270867, '1.0': 839.3841400668252}, '12 days': {'0.0': -907.5228930689577, '0.01': -905.6020609256032, '0.05': -791.6344884981407, '1.0': 929.4732181992737}}, '2022-02-09': {'1 day': {'0.0': -490.62249763018633, '0.01': -381.31079257162133, '0.05': -242.6702565720098, '1.0': 372.88872391521807}, '2 day': {'0.0': -687.7684781484123, '0.01': -602.7965551671558, '0.05': -341.49968925067003, '1.0': 414.8023433984876}, '5 day': {'0.0': -880.2136223352967, '0.01': -826.7227021501438, '0.05': -620.9781739941764, '1.0': 599.221201709577}, '10 day': {'0.0': -997.8328184281913, '0.01': -942.7818413936427, '0.05': -858.800153900951, '1.0': 887.1487763457583}, '12 days': {'0.0': -960.012660927301, '0.01': -957.6894559948958, '0.05': -837.2053002674251, '1.0': 982.6336165049206}}, '2022-02-08': {'1 day': {'0.0': -472.7999702966495, '0.01': -367.469683362886, '0.05': -233.90104141132935, '1.0': 359.2959422091179}, '2 day': {'0.0': -662.8807163345261, '0.01': -580.936527163602, '0.05': -329.1098446639195, '1.0': 399.70128308130853}, '5 day': {'0.0': -848.3984910654409, '0.01': -796.804833178246, '0.05': -598.5108397960455, '1.0': 577.4579246335493}, '10 day': {'0.0': -961.6619784306176, '0.01': -908.7115023415581, '0.05': -827.783546253264, '1.0': 854.8229339639882}, '12 days': {'0.0': -925.3285543051609, '0.01': -922.9874159179598, '0.05': -806.882483932031, '1.0': 946.9227722079486}}, '2022-02-07': {'1 day': {'0.0': -475.81111294210655, '0.01': -369.78086520064767, '0.05': -235.26300380557313, '1.0': 361.71462099323577}, '2 day': {'0.0': -666.8355859175034, '0.01': -584.5328649596266, '0.05': -331.1626757850905, '1.0': 402.33771902277005}, '5 day': {'0.0': -853.3591342482405, '0.01': -801.5639103728433, '0.05': -602.0718732239745, '1.0': 581.1238504484566}, '10 day': {'0.0': -967.5739064570784, '0.01': -914.0073372798491, '0.05': -832.555711561476, '1.0': 860.541132413362}, '12 days': {'0.0': -930.6965299125011, '0.01': -928.6238532506613, '0.05': -811.7726288388078, '1.0': 908.0625323462758}}, '2022-02-06': {'1 day': {'0.0': -462.5865010898016, '0.01': -359.47090249028975, '0.05': -228.58243543260397, '1.0': 351.80591563273043}, '2 day': {'0.0': -648.0055353492778, '0.01': -568.171600707228, '0.05': -321.9104719660642, '1.0': 391.25602457462486}, '5 day': {'0.0': -829.149849602805, '0.01': -778.9351755642018, '0.05': -585.0597424940802, '1.0': 489.24773264427915}, '10 day': {'0.0': -940.4453320944995, '0.01': -888.0581104718098, '0.05': -808.8611704804193, '1.0': 836.9275285016726}, '12 days': {'0.0': -904.246059843632, '0.01': -902.545464724647, '0.05': -788.9343815794576, '1.0': 774.0744062882357}}, '2022-02-05': {'1 day': {'0.0': -455.7403816727309, '0.01': -354.1494235869116, '0.05': -225.19320853483134, '1.0': 346.60573061698534}, '2 day': {'0.0': -638.4021418194309, '0.01': -559.7577633042473, '0.05': -317.14418286659895, '1.0': 385.47004344021474}, '5 day': {'0.0': -816.8569314920588, '0.01': -767.3916703578059, '0.05': -576.3887183593564, '1.0': 482.0083945507587}, '10 day': {'0.0': -926.5165993051927, '0.01': -874.8909619486437, '0.05': -796.8657024993728, '1.0': 698.9243325892651}, '12 days': {'0.0': -890.8376767966707, '0.01': -889.1762001684021, '0.05': -777.246184355151, '1.0': 732.8052862929452}}}}
    },
    'WETH (90 days)': {
        'input': {"portfolio": {"positions": [{"amount":  1, "asset": {"symbol": "WETH"}}]}, "window": "90 days", "intervals": [
            "1 day", "2 day", "5 day", "10 day", "12 days"], "asOfs": ["2022-02-17", "2022-02-05"], "asOf_is_range": True, "confidences": [0, 0.01, 0.05, 1.0], "dev_mode": True},
        'output': {'window': '90 days', 'var': {'2022-02-17': {'1 day': {'0.0': -456.5594997059149, '0.01': -353.5216299655959, '0.05': -216.21315225357029, '1.0': 352.8872721977731}, '2 day': {'0.0': -627.9712047469739, '0.01': -556.2730954413886, '0.05': -316.591002303369, '1.0': 390.10434593060677}, '5 day': {'0.0': -799.1214397082888, '0.01': -755.078606188031, '0.05': -568.9713572112368, '1.0': 557.0876479208343}, '10 day': {'0.0': -918.9550490478434, '0.01': -855.1368973380721, '0.05': -776.6130021820055, '1.0': 837.927539836364}, '12 days': {'0.0': -883.2797765531519, '0.01': -872.648964882241, '0.05': -765.2480352009076, '1.0': 916.3297477687664}}, '2022-02-16': {'1 day': {'0.0': -456.5594997059149, '0.01': -353.5216299655959, '0.05': -216.21315225357029, '1.0': 352.8872721977731}, '2 day': {'0.0': -627.9712047469739, '0.01': -556.2730954413886, '0.05': -316.591002303369, '1.0': 390.10434593060677}, '5 day': {'0.0': -799.1214397082888, '0.01': -755.078606188031, '0.05': -568.9713572112368, '1.0': 557.0876479208343}, '10 day': {'0.0': -918.9550490478434, '0.01': -855.1368973380721, '0.05': -776.6130021820055, '1.0': 837.927539836364}, '12 days': {'0.0': -883.2797765531519, '0.01': -872.648964882241, '0.05': -765.2480352009076, '1.0': 916.3297477687664}}, '2022-02-15': {'1 day': {'0.0': -456.5594997059149, '0.01': -353.5216299655959, '0.05': -216.21315225357029, '1.0': 352.8872721977731}, '2 day': {'0.0': -627.9712047469739, '0.01': -556.2730954413886, '0.05': -316.591002303369, '1.0': 390.10434593060677}, '5 day': {'0.0': -799.1214397082888, '0.01': -755.078606188031, '0.05': -568.9713572112368, '1.0': 557.0876479208343}, '10 day': {'0.0': -918.9550490478434, '0.01': -855.1368973380721, '0.05': -776.6130021820055, '1.0': 837.927539836364}, '12 days': {'0.0': -883.2797765531519, '0.01': -872.648964882241, '0.05': -765.2480352009076, '1.0': 916.3297477687664}}, '2022-02-14': {'1 day': {'0.0': -420.17746785470933, '0.01': -325.35041633455074, '0.05': -198.9836919159672, '1.0': 324.7666088773202}, '2 day': {'0.0': -577.9298226544738, '0.01': -511.94514806683276, '0.05': -291.362693754263, '1.0': 359.01795139039217}, '5 day': {'0.0': -735.4415432409596, '0.01': -694.9083678769409, '0.05': -523.6315185838142, '1.0': 512.694790990633}, '10 day': {'0.0': -845.7259258211436, '0.01': -786.9932756280105, '0.05': -714.7267442032625, '1.0': 771.1552867938456}, '12 days': {'0.0': -812.8935224399813, '0.01': -803.1098523334545, '0.05': -704.2674217021512, '1.0': 843.309827931364}}, '2022-02-13': {'1 day': {'0.0': -412.1169246364532, '0.01': -319.10900337794476, '0.05': -198.6365187499593, '1.0': 318.5363954866124}, '2 day': {'0.0': -566.8430113211343, '0.01': -502.1241645370921, '0.05': -285.773289835998, '1.0': 352.1306717652203}, '5 day': {'0.0': -721.3330800383479, '0.01': -681.5774794773357, '0.05': -513.5863476527414, '1.0': 502.8594265631816}, '10 day': {'0.0': -829.5018041168398, '0.01': -771.8958613305116, '0.05': -701.0156667380472, '1.0': 756.361703147095}, '12 days': {'0.0': -797.2992465190897, '0.01': -787.7032630491867, '0.05': -690.7569923618446, '1.0': 827.1320558363326}}, '2022-02-12': {'1 day': {'0.0': -417.61714027270216, '0.01': -323.3679120155735, '0.05': -201.28757145137985, '1.0': 322.78766195598973}, '2 day': {'0.0': -574.4082400409139, '0.01': -508.8256393274363, '0.05': -289.5872916961858, '1.0': 356.830295855045}, '5 day': {'0.0': -730.960171886785, '0.01': -690.6739831291657, '0.05': -520.4407996081313, '1.0': 509.5707143445749}, '10 day': {'0.0': -840.5725428333459, '0.01': -782.1977767148196, '0.05': -710.3715973027757, '1.0': 766.4562957678165}, '12 days': {'0.0': -807.9402018410346, '0.01': -798.2161479737005, '0.05': -699.9760080904233, '1.0': 838.1711672990976}}, '2022-02-11': {'1 day': {'0.0': -419.57830763143255, '0.01': -324.8864765876397, '0.05': -202.23283584974908, '1.0': 324.3035016219948}, '2 day': {'0.0': -577.1057123961396, '0.01': -511.2151299371427, '0.05': -290.94721946066124, '1.0': 358.50600276779295}, '5 day': {'0.0': -734.3928260845994,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          '0.01': -693.9174497894485, '0.05': -522.8848360470488, '1.0': 511.96370389305207}, '10 day': {'0.0': -844.5199465068955, '0.01': -785.8710472773325, '0.05': -713.7075657170262, '1.0': 770.0556429310379}, '12 days': {'0.0': -811.7343611291855, '0.01': -801.964642237119, '0.05': -703.2631578900338, '1.0': 842.1072938988405}}, '2022-02-10': {'1 day': {'0.0': -440.0116526475377, '0.01': -340.70835619017976, '0.05': -212.08151780814333, '1.0': 340.0969905084465}, '2 day': {'0.0': -605.2105975097762, '0.01': -536.1111623045608, '0.05': -305.11626683176223, '1.0': 375.96514379501195}, '5 day': {'0.0': -770.1575491882562, '0.01': -727.71103350517, '0.05': -548.3491798043631, '1.0': 536.896191600589}, '10 day': {'0.0': -885.6478292551058, '0.01': -824.1427452062238, '0.05': -748.4649224860777, '1.0': 807.5571351374235}, '12 days': {'0.0': -851.2655951341385, '0.01': -841.0200936927814, '0.05': -737.5118749493191, '1.0': 883.1176811468123}}, '2022-02-09': {'1 day': {'0.0': -464.6459316991146, '0.01': -359.78308903212127, '0.05': -223.95501083936705, '1.0': 359.13749572774265}, '2 day': {'0.0': -639.0936245939928, '0.01': -566.1256219112812, '0.05': -322.19835821521434, '1.0': 397.01374605403305}, '5 day': {'0.0': -813.275216336902, '0.01': -768.4523106063871, '0.05': -579.0487911253944, '1.0': 566.9546014768662}, '10 day': {'0.0': -935.2312792297134, '0.01': -870.2828013651579, '0.05': -790.3681167535445, '1.0': 852.7686373723487}, '12 days': {'0.0': -898.9241380189991, '0.01': -888.1050369013354, '0.05': -778.8018572078262, '1.0': 932.5594794761362}}, '2022-02-08': {'1 day': {'0.0': -447.57368170272673, '0.01': -346.5637613217335, '0.05': -215.7263453714225, '1.0': 345.9418887249656}, '2 day': {'0.0': -615.6117314237075, '0.01': -545.3247550850358, '0.05': -310.359987222142, '1.0': 382.4264711803428}, '5 day': {'0.0': -783.393457212492, '0.01': -740.2174567920001, '0.05': -557.7730948418844, '1.0': 546.1232758745507}, '10 day': {'0.0': -900.8685502910029, '0.01': -838.3064414342074, '0.05': -761.3280215803267, '1.0': 821.4357914932044}, '12 days': {'0.0': -865.8954239701571, '0.01': -855.4738436019844, '0.05': -750.1867352475783, '1.0': 898.2949191217638}}, '2022-02-07': {'1 day': {'0.0': -450.95962255911576, '0.01': -349.1855517593189, '0.05': -217.35833732370565, '1.0': 348.55897463250614}, '2 day': {'0.0': -620.2688973794224, '0.01': -549.4501928480837, '0.05': -312.70789239146734, '1.0': 385.31956670018667}, '5 day': {'0.0': -789.3199091506677, '0.01': -745.8172778539299, '0.05': -561.9927055733169, '1.0': 550.2547545293587}, '10 day': {'0.0': -907.6837133699888, '0.01': -844.6483157361719, '0.05': -767.0875462323924, '1.0': 827.6500375961833}, '12 days': {'0.0': -872.4460117576851, '0.01': -861.9455910639989, '0.05': -755.861974924613, '1.0': 866.6393972582973}}, '2022-02-06': {'1 day': {'0.0': -439.01995710450177, '0.01': -339.9404698029082, '0.05': -211.60352979417794, '1.0': 339.33048201336965}, '2 day': {'0.0': -603.8465776059004, '0.01': -534.9028782806487, '0.05': -304.4285976754928, '1.0': 375.117795877758}, '5 day': {'0.0': -768.4217728642204, '0.01': -726.0709228758201, '0.05': -547.1133138122527, '1.0': 465.4753881606003}, '10 day': {'0.0': -883.6517616516979, '0.01': -822.2852973810839, '0.05': -746.7780368700218, '1.0': 805.7370678577414}, '12 days': {'0.0': -849.3470179974768, '0.01': -839.124607803941, '0.05': -735.8496752441009, '1.0': 748.869853253407}}, '2022-02-05': {'1 day': {'0.0': -432.54897471512277, '0.01': -334.929880288846, '0.05': -208.48457656057215, '1.0': 334.32888348065114}, '2 day': {'0.0': -594.9461153231699, '0.01': -527.0186191498996, '0.05': -299.94143926161564, '1.0': 369.5887063414255}, '5 day': {'0.0': -757.0955365978446, '0.01': -715.3689215673664, '0.05': -539.0490776394283, '1.0': 458.6144630688518}, '10 day': {'0.0': -870.6270804374205, '0.01': -810.1651338388791, '0.05': -735.7708208035078, '1.0': 674.0897128073706}, '12 days': {'0.0': -836.8279752820108, '0.01': -826.7562394149354, '0.05': -725.0035389519383, '1.0': 714.3477326482058}}}},
    },
    'WETH (39 days)': {
        'input': {"portfolio": {"positions": [{"amount":  1, "asset": {"symbol": "WETH"}}]}, "window": "39 days", "intervals": [
            "1 day", "2 day", "5 day", "10 day", "12 days"], "asOfs": ["2022-02-17", "2022-02-05"], "asOf_is_range": True, "confidences": [0, 0.01, 0.05, 1.0], "dev_mode": True},
        'output': {'window': '39 days', 'var': {'2022-02-17': {'1 day': {'0.0': -456.5594997059149, '0.01': -359.0985901304979, '0.05': -172.0333443200791, '1.0': 352.8872721977731}, '2 day': {'0.0': -627.9712047469739, '0.01': -597.8254087889437, '0.05': -344.647899885906, '1.0': 390.10434593060677}, '5 day': {'0.0': -799.1214397082888, '0.01': -781.5043063001856, '0.05': -695.5242896596901, '1.0': 557.0876479208343}, '10 day': {'0.0': -918.9550490478434, '0.01': -895.8209690530513, '0.05': -837.3449546893454, '1.0': 837.927539836364}, '12 days': {'0.0': -883.2797765531519, '0.01': -879.599880205529, '0.05': -848.5734961984331, '1.0': 916.3297477687664}}, '2022-02-16': {'1 day': {'0.0': -456.5594997059149, '0.01': -359.0985901304979, '0.05': -172.0333443200791, '1.0': 352.8872721977731}, '2 day': {'0.0': -627.9712047469739, '0.01': -597.8254087889437, '0.05': -344.647899885906, '1.0': 390.10434593060677}, '5 day': {'0.0': -799.1214397082888, '0.01': -781.5043063001856, '0.05': -695.5242896596901, '1.0': 557.0876479208343}, '10 day': {'0.0': -918.9550490478434, '0.01': -895.8209690530513, '0.05': -837.3449546893454, '1.0': 837.927539836364}, '12 days': {'0.0': -883.2797765531519, '0.01': -879.599880205529, '0.05': -848.5734961984331, '1.0': 916.3297477687664}}, '2022-02-15': {'1 day': {'0.0': -456.5594997059149, '0.01': -359.0985901304979, '0.05': -172.0333443200791, '1.0': 352.8872721977731}, '2 day': {'0.0': -627.9712047469739, '0.01': -597.8254087889437, '0.05': -344.647899885906, '1.0': 390.10434593060677}, '5 day': {'0.0': -799.1214397082888, '0.01': -781.5043063001856, '0.05': -695.5242896596901, '1.0': 557.0876479208343}, '10 day': {'0.0': -918.9550490478434, '0.01': -895.8209690530513, '0.05': -837.3449546893454, '1.0': 837.927539836364}, '12 days': {'0.0': -883.2797765531519, '0.01': -879.599880205529, '0.05': -848.5734961984331, '1.0': 916.3297477687664}}, '2022-02-14': {'1 day': {'0.0': -420.17746785470933, '0.01': -334.5587305289809, '0.05': -185.2118679116306, '1.0': 324.7666088773202}, '2 day': {'0.0': -577.9298226544738, '0.01': -550.186266293761, '0.05': -317.1838105850001, '1.0': 359.01795139039217}, '5 day': {'0.0': -735.4415432409596, '0.01': -719.228273095352, '0.05': -640.099778996818, '1.0': 512.694790990633}, '10 day': {'0.0': -845.7259258211436, '0.01': -824.4353401261328, '0.05': -770.6191263327408, '1.0': 771.1552867938456}, '12 days': {'0.0': -812.8935224399813, '0.01': -809.5068674031066, '0.05': -780.9528947507215, '1.0': 843.309827931364}}, '2022-02-13': {'1 day': {'0.0': -412.1169246364532, '0.01': -328.14066837004987, '0.05': -181.65882573291037, '1.0': 318.5363954866124}, '2 day': {'0.0': -566.8430113211343, '0.01': -539.6316780142074, '0.05': -318.0539317864216, '1.0': 352.1306717652203}, '5 day': {'0.0': -721.3330800383479, '0.01': -705.430839813943, '0.05': -627.8203201316317, '1.0': 502.8594265631816}, '10 day': {'0.0': -829.5018041168398, '0.01': -808.6196498567958, '0.05': -755.8358282079406, '1.0': 756.361703147095}, '12 days': {'0.0': -797.2992465190897, '0.01': -793.9775599333541, '0.05': -765.9713570883138, '1.0': 827.1320558363326}}, '2022-02-12': {'1 day': {'0.0': -417.61714027270216, '0.01': -332.5201158694465, '0.05': -190.4734419817381, '1.0': 322.78766195598973}, '2 day': {'0.0': -574.4082400409139, '0.01': -546.8337374682018, '0.05': -322.29875917448703, '1.0': 356.830295855045}, '5 day': {'0.0': -730.960171886785, '0.01': -714.8456963837372, '0.05': -636.1993672784797, '1.0': 509.5707143445749}, '10 day': {'0.0': -840.5725428333459, '0.01': -819.41169011538, '0.05': -765.9234023700885, '1.0': 766.4562957678165}, '12 days': {'0.0': -807.9402018410346, '0.01': -804.5741831946498, '0.05': -776.1942025559986, '1.0': 838.1711672990976}}, '2022-02-11': {'1 day': {'0.0': -419.57830763143255, '0.01': -334.0816600075501, '0.05': -191.36792226306866, '1.0': 324.3035016219948}, '2 day': {'0.0': -577.1057123961396, '0.01': -549.4017174986068, '0.05': -323.8123029094007, '1.0': 358.50600276779295}, '5 day': {'0.0': -734.3928260845994,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    '0.01': -718.202675566539, '0.05': -639.1870162814319, '1.0': 511.96370389305207}, '10 day': {'0.0': -844.5199465068955, '0.01': -823.2597205361789, '0.05': -769.520247018359, '1.0': 770.0556429310379}, '12 days': {'0.0': -811.7343611291855, '0.01': -808.3525353588548, '0.05': -779.839279798505, '1.0': 842.1072938988405}}, '2022-02-10': {'1 day': {'0.0': -440.0116526475377, '0.01': -350.35134244424046, '0.05': -200.68748600002755, '1.0': 340.0969905084465}, '2 day': {'0.0': -605.2105975097762, '0.01': -576.1574258894016, '0.05': -339.58187055735334, '1.0': 375.96514379501195}, '5 day': {'0.0': -770.1575491882562, '0.01': -753.1789429150217, '0.05': -670.3152433511834, '1.0': 536.896191600589}, '10 day': {'0.0': -885.6478292551058, '0.01': -863.352236287386, '0.05': -806.9956655950906, '1.0': 807.5571351374235}, '12 days': {'0.0': -851.2655951341385, '0.01': -847.719075404438, '0.05': -817.8172323556502, '1.0': 883.1176811468123}}, '2022-02-09': {'1 day': {'0.0': -464.6459316991146, '0.01': -369.9659428393337, '0.05': -211.92307829068045, '1.0': 359.13749572774265}, '2 day': {'0.0': -639.0936245939928, '0.01': -608.4138961933072, '0.05': -358.5935365208163, '1.0': 397.01374605403305}, '5 day': {'0.0': -813.275216336902, '0.01': -795.346054044696, '0.05': -707.8431875723923, '1.0': 566.9546014768662}, '10 day': {'0.0': -935.2312792297134, '0.01': -911.687456003812, '0.05': -852.1757336684395, '1.0': 852.7686373723487}, '12 days': {'0.0': -898.9241380189991, '0.01': -895.1790645551924, '0.05': -863.603151418969, '1.0': 932.5594794761362}}, '2022-02-08': {'1 day': {'0.0': -447.57368170272673, '0.01': -356.37247169194717, '0.05': -204.13649602286142, '1.0': 345.9418887249656}, '2 day': {'0.0': -615.6117314237075, '0.01': -586.059252735857, '0.05': -345.4179159355132, '1.0': 382.4264711803428}, '5 day': {'0.0': -783.393457212492, '0.01': -766.1230570442953, '0.05': -681.8352640503128, '1.0': 546.1232758745507}, '10 day': {'0.0': -900.8685502910029, '0.01': -878.1897858304145, '0.05': -820.8646725496178, '1.0': 821.4357914932044}, '12 days': {'0.0': -865.8954239701571, '0.01': -862.2879538427128, '0.05': -831.8722184808961, '1.0': 898.2949191217638}}, '2022-02-07': {'1 day': {'0.0': -450.95962255911576, '0.01': -359.06846603058557, '0.05': -205.68080957484318, '1.0': 348.55897463250614}, '2 day': {'0.0': -620.2688973794224, '0.01': -590.4928511560186, '0.05': -348.031037935103, '1.0': 385.31956670018667}, '5 day': {'0.0': -789.3199091506677, '0.01': -771.9188566319726, '0.05': -686.993417829802, '1.0': 550.2547545293587}, '10 day': {'0.0': -907.6837133699888, '0.01': -884.83338172773, '0.05': -827.0745980791493, '1.0': 827.6500375961833}, '12 days': {'0.0': -872.4460117576851, '0.01': -868.8112507483322, '0.05': -838.1654172255895, '1.0': 866.6393972582973}}, '2022-02-06': {'1 day': {'0.0': -439.01995710450177, '0.01': -349.56172275415264, '0.05': -200.23517778452504, '1.0': 339.33048201336965}, '2 day': {'0.0': -603.8465776059004, '0.01': -574.8588858441468, '0.05': -338.8165230364383, '1.0': 375.117795877758}, '5 day': {'0.0': -768.4217728642204, '0.01': -751.4814328688602, '0.05': -668.8044909989204, '1.0': 465.4753881606003}, '10 day': {'0.0': -883.6517616516979, '0.01': -861.4064183536003, '0.05': -805.1768637519926, '1.0': 805.7370678577414}, '12 days': {'0.0': -849.3470179974768, '0.01': -845.8084913920221, '0.05': -815.974040932275, '1.0': 748.869853253407}}, '2022-02-05': {'1 day': {'0.0': -432.54897471512277, '0.01': -344.40931973616256, '0.05': -197.28378961136872, '1.0': 334.32888348065114}, '2 day': {'0.0': -594.9461153231699, '0.01': -566.3856907957722, '0.05': -333.82250005793946, '1.0': 369.5887063414255}, '5 day': {'0.0': -757.0955365978446, '0.01': -740.4048905856532, '0.05': -658.9465744893039, '1.0': 458.6144630688518}, '10 day': {'0.0': -870.6270804374205, '0.01': -848.7096247954494, '0.05': -793.3088718273468, '1.0': 674.0897128073706}, '12 days': {'0.0': -836.8279752820108, '0.01': -833.3416051741771, '0.05': -803.9469028406772, '1.0': 714.3477326482058}}}},
    },
    'AAVE (39 days)': {
        'input': {"portfolio": {"positions": [{"amount":  1, "asset": {"symbol": "AAVE"}}]}, "window": "39 days", "intervals": [
            "1 day", "2 day", "5 day", "10 day", "12 days"], "asOfs": ["2022-02-17", "2022-02-05"], "asOf_is_range": True, "confidences": [0, 0.01, 0.05, 1.0], "dev_mode": True},
        'output': {'window': '39 days', 'var': {'2022-02-17': {'1 day': {'0.0': -23.798160776320955, '0.01': -23.677729437342894, '0.05': -17.778002984183267, '1.0': 13.997656695470777}, '2 day': {'0.0': -43.99910813259844, '0.01': -39.43683402265586, '0.05': -26.582514070467397, '1.0': 25.662383596073354}, '5 day': {'0.0': -60.50824909938994, '0.01': -58.73584238519949, '0.05': -52.49171302212876, '1.0': 34.97267346437617}, '10 day': {'0.0': -67.77140891343997, '0.01': -66.85983814130928, '0.05': -63.381714162545485, '1.0': 47.53537023601923}, '12 days': {'0.0': -67.75852789814252, '0.01': -67.1907344951745, '0.05': -64.50023152518025, '1.0': 45.26397531556596}}, '2022-02-16': {'1 day': {'0.0': -23.798160776320955, '0.01': -23.677729437342894, '0.05': -17.778002984183267, '1.0': 13.997656695470777}, '2 day': {'0.0': -43.99910813259844, '0.01': -39.43683402265586, '0.05': -26.582514070467397, '1.0': 25.662383596073354}, '5 day': {'0.0': -60.50824909938994, '0.01': -58.73584238519949, '0.05': -52.49171302212876, '1.0': 34.97267346437617}, '10 day': {'0.0': -67.77140891343997, '0.01': -66.85983814130928, '0.05': -63.381714162545485, '1.0': 47.53537023601923}, '12 days': {'0.0': -67.75852789814252, '0.01': -67.1907344951745, '0.05': -64.50023152518025, '1.0': 45.26397531556596}}, '2022-02-15': {'1 day': {'0.0': -23.798160776320955, '0.01': -23.677729437342894, '0.05': -17.778002984183267, '1.0': 13.997656695470777}, '2 day': {'0.0': -43.99910813259844, '0.01': -39.43683402265586, '0.05': -26.582514070467397, '1.0': 25.662383596073354}, '5 day': {'0.0': -60.50824909938994, '0.01': -58.73584238519949, '0.05': -52.49171302212876, '1.0': 34.97267346437617}, '10 day': {'0.0': -67.77140891343997, '0.01': -66.85983814130928, '0.05': -63.381714162545485, '1.0': 47.53537023601923}, '12 days': {'0.0': -67.75852789814252, '0.01': -67.1907344951745, '0.05': -64.50023152518025, '1.0': 45.26397531556596}}, '2022-02-14': {'1 day': {'0.0': -22.400887107838166, '0.01': -22.287526716081437, '0.05': -16.73419394022033, '1.0': 13.175805069839951}, '2 day': {'0.0': -41.41576583954284, '0.01': -37.121358878752666, '0.05': -25.021761233227366, '1.0': 24.15565485319605}, '5 day': {'0.0': -56.955597111396884, '0.01': -55.28725462531453, '0.05': -49.409740044941636, '1.0': 32.91930487814318}, '10 day': {'0.0': -63.79231128313273, '0.01': -62.93426203515798, '0.05': -59.6603509406134, '1.0': 44.7444015650933}, '12 days': {'0.0': -63.78018655751949, '0.01': -63.24573030100419, '0.05': -60.71319621735716, '1.0': 42.60636822425557}}, '2022-02-13': {'1 day': {'0.0': -21.929519141294918, '0.01': -21.81854412191615, '0.05': -16.382066681537708, '1.0': 12.898554779999085}, '2 day': {'0.0': -40.54427957952835, '0.01': -36.34023715952051, '0.05': -24.49524383884658, '1.0': 23.647362397908086}, '5 day': {'0.0': -55.75711582516863, '0.01': -54.12387923473125, '0.05': -48.37004154638238, '1.0': 32.22660437366191}, '10 day': {'0.0': -62.44996926311055, '0.01': -61.60997541299861, '0.05': -58.40495519799152, '1.0': 43.80287288909043}, '12 days': {'0.0': -62.4380996705744, '0.01': -61.91488964540821, '0.05': -59.435646104919726, '1.0': 41.70982885708769}}, '2022-02-12': {'1 day': {'0.0': -22.516091428609652, '0.01': -22.402148041774566, '0.05': -16.820255328649313, '1.0': 13.24356621101178}, '2 day': {'0.0': -41.628760760226406, '0.01': -37.312268324220334, '0.05': -25.150444306960264, '1.0': 24.27988367488317}, '5 day': {'0.0': -57.24851099680533, '0.01': -55.571588481637605, '0.05': -49.66384674678656, '1.0': 33.08860380548026}, '10 day': {'0.0': -64.12038533914836, '0.01': -63.2579232757201, '0.05': -59.96717495941295, '1.0': 44.97451514790893}, '12 days': {'0.0': -64.1081982579341, '0.01': -63.57099337500426, '0.05': -61.02543485765811, '1.0': 42.82548623008212}}, '2022-02-11': {'1 day': {'0.0': -22.90625945963707, '0.01': -22.79034161524433, '0.05': -17.111723584752536, '1.0': 13.473056136859483}, '2 day': {'0.0': -42.35012093374618, '0.01': -37.95883055334372, '0.05': -25.586261480905595, '1.0': 24.700615418535932}, '5 day': {
            '0.0': -58.24053658373707, '0.01': -56.53455567013447, '0.05': -50.52444217294564, '1.0': 33.66197665028167}, '10 day': {'0.0': -65.23148957212844, '0.01': -64.35408241371377, '0.05': -61.00631066617517, '1.0': 45.753851920337205}, '12 days': {'0.0': -65.21909130819199, '0.01': -64.67257751958037, '0.05': -62.08290852427996, '1.0': 43.567583751455295}}, '2022-02-10': {'1 day': {'0.0': -24.372064449845283, '0.01': -24.248728853328306, '0.05': -18.206727763230102, '1.0': 14.335216672217225}, '2 day': {'0.0': -45.060167011325625, '0.01': -40.38787154738303, '0.05': -27.223563713754654, '1.0': 26.281243866646488}, '5 day': {'0.0': -61.96743356171264, '0.01': -60.15228443840016, '0.05': -53.757575002646135, '1.0': 35.81605568886063}, '10 day': {'0.0': -69.40574783991879, '0.01': -68.47219411626001, '0.05': -64.91019356622894, '1.0': 48.68170771382696}, '12 days': {'0.0': -69.39255619296928, '0.01': -68.81107018901294, '0.05': -66.05568449330634, '1.0': 46.35553705246139}}, '2022-02-09': {'1 day': {'0.0': -26.32716979537433, '0.01': -26.193940326939337, '0.05': -19.667255280204937, '1.0': 15.485175010906376}, '2 day': {'0.0': -48.67485355441958, '0.01': -43.627750701622276, '0.05': -29.407413795500606, '1.0': 28.389501887897502}, '5 day': {'0.0': -66.93840599839473, '0.01': -64.97764722591923, '0.05': -58.06995988356743, '1.0': 38.689187838874375}, '10 day': {'0.0': -74.97341523598658, '0.01': -73.96497266246365, '0.05': -70.11723159461658, '1.0': 52.58691103284206}, '12 days': {'0.0': -74.959165366845, '0.01': -74.33103307254157, '0.05': -71.35461278562272, '1.0': 50.074137028784385}}, '2022-02-08': {'1 day': {'0.0': -25.56676601832562, '0.01': -25.437384597052535, '0.05': -19.099208835581916, '1.0': 15.03791897624433}, '2 day': {'0.0': -47.26898491081868, '0.01': -42.36765678816706, '0.05': -28.558043783564806, '1.0': 27.56953207603107}, '5 day': {'0.0': -65.00503385294891, '0.01': -63.100907388011976, '0.05': -56.392733764249044, '1.0': 37.57173371097962}, '10 day': {'0.0': -72.80796909928478, '0.01': -71.82865322444628, '0.05': -68.09204589652786, '1.0': 37.49964538914613}, '12 days': {'0.0': -72.79413080701994, '0.01': -72.18414076548379, '0.05': -69.29368798839789, '1.0': 48.627853086184814}}, '2022-02-07': {'1 day': {'0.0': -25.186909182576375, '0.01': -25.059450038733857, '0.05': -18.815443378957564, '1.0': 14.814493912844629}, '2 day': {'0.0': -46.566688538081024, '0.01': -41.738181631468414, '0.05': -28.13374420108974, '1.0': 27.159919252493587}, '5 day': {'0.0': -64.0392250975727, '0.01': -62.163389088038656, '0.05': -55.55488178908789, '1.0': 37.01351372058912}, '10 day': {'0.0': -71.7262286578242, '0.01': -70.76146291533911, '0.05': -67.08037202759161, '1.0': 36.94249644707698}, '12 days': {'0.0': -71.71259596723412, '0.01': -71.1116688195677, '0.05': -68.26416078742919, '1.0': 41.42313508797853}}, '2022-02-06': {'1 day': {'0.0': -23.884619954672644, '0.01': -23.763751086310958, '0.05': -17.842590812847558, '1.0': 19.239300100134834}, '2 day': {'0.0': -44.158957743377464, '0.01': -39.58010880336006, '0.05': -26.679088858185516, '1.0': 25.755615531982873}, '5 day': {'0.0': -60.72807673858456, '0.01': -58.94923083652348, '0.05': -52.68241643071661, '1.0': 35.099729863436245}, '10 day': {'0.0': -68.01762375270698, '0.01': -67.10274122633155, '0.05': -63.611981155886745, '1.0': 31.190460643931143}, '12 days': {'0.0': -68.00469594043184, '0.01': -67.43483973304984, '0.05': -64.73456211373184, '1.0': 25.20455303482872}}, '2022-02-05': {'1 day': {'0.0': -23.504419729177997, '0.01': -23.38547487598145, '0.05': -17.55856883287353, '1.0': 18.933045018399717}, '2 day': {'0.0': -43.456026496261, '0.01': -38.95006460250201, '0.05': -26.254405709819594, '1.0': 25.34563241935237}, '5 day': {'0.0': -59.761394894214284, '0.01': -58.010865022065644, '0.05': -51.84380703920972, '1.0': 34.54100524340021}, '10 day': {'0.0': -66.93490542026268, '0.01': -66.03458617952836, '0.05': -62.59939273599447, '1.0': 24.834619781894485}, '12 days': {'0.0': -66.92218339552576, '0.01': -66.36139827484965, '0.05': -63.704104222434175, '1.0': 18.457553644739363}}}},
    },
    'AAVE (90 days)': {
        'input': {"portfolio": {"positions": [{"amount":  1, "asset": {"symbol": "AAVE"}}]}, "window": "90 days", "intervals": [
            "1 day", "2 day", "5 day", "10 day", "12 days"], "asOfs": ["2022-02-17", "2022-02-05"], "asOf_is_range": True, "confidences": [0, 0.01, 0.05, 1.0], "dev_mode": True},
        'output':  {'window': '90 days', 'var': {'2022-02-17': {'1 day': {'0.0': -23.798160776320955, '0.01': -23.516097903451286, '0.05': -18.3514048394348, '1.0': 30.836735475126957}, '2 day': {'0.0': -43.99910813259844, '0.01': -33.148294033275555, '0.05': -26.22795057234318, '1.0': 55.44160940335445}, '5 day': {'0.0': -60.50824909938994, '0.01': -56.07723231391381, '0.05': -44.49446310359439, '1.0': 78.48584437175849}, '10 day': {'0.0': -67.77140891343997, '0.01': -65.25673092135531, '0.05': -60.328405710874996, '1.0': 100.05412920330795}, '12 days': {'0.0': -67.75852789814252, '0.01': -66.1182358451238, '0.05': -58.10269121444972, '1.0': 106.69526640426028}}, '2022-02-16': {'1 day': {'0.0': -23.798160776320955, '0.01': -23.516097903451286, '0.05': -18.3514048394348, '1.0': 30.836735475126957}, '2 day': {'0.0': -43.99910813259844, '0.01': -33.148294033275555, '0.05': -26.22795057234318, '1.0': 55.44160940335445}, '5 day': {'0.0': -60.50824909938994, '0.01': -56.07723231391381, '0.05': -44.49446310359439, '1.0': 78.48584437175849}, '10 day': {'0.0': -67.77140891343997, '0.01': -65.25673092135531, '0.05': -60.328405710874996, '1.0': 100.05412920330795}, '12 days': {'0.0': -67.75852789814252, '0.01': -66.1182358451238, '0.05': -58.10269121444972, '1.0': 106.69526640426028}}, '2022-02-15': {'1 day': {'0.0': -23.798160776320955, '0.01': -23.516097903451286, '0.05': -18.3514048394348, '1.0': 30.836735475126957}, '2 day': {'0.0': -43.99910813259844, '0.01': -33.148294033275555, '0.05': -26.22795057234318, '1.0': 55.44160940335445}, '5 day': {'0.0': -60.50824909938994, '0.01': -56.07723231391381, '0.05': -44.49446310359439, '1.0': 78.48584437175849}, '10 day': {'0.0': -67.77140891343997, '0.01': -65.25673092135531, '0.05': -60.328405710874996, '1.0': 100.05412920330795}, '12 days': {'0.0': -67.75852789814252, '0.01': -66.1182358451238, '0.05': -58.10269121444972, '1.0': 106.69526640426028}}, '2022-02-14': {'1 day': {'0.0': -22.400887107838166, '0.01': -22.13538513767109, '0.05': -17.27392935707217, '1.0': 29.02620234585103}, '2 day': {'0.0': -41.41576583954284, '0.01': -31.20204117604188, '0.05': -24.688015404350388, '1.0': 52.18643764089227}, '5 day': {'0.0': -56.955597111396884, '0.01': -52.78474089619102, '0.05': -41.8820367790445, '1.0': 73.87766457500656}, '10 day': {'0.0': -63.79231128313273, '0.01': -61.42527887492652, '0.05': -56.78631296036186, '1.0': 94.17959959268946}, '12 days': {'0.0': -63.78018655751949, '0.01': -62.23620181647529, '0.05': -54.69127798529312, '1.0': 100.43081228531989}}, '2022-02-13': {'1 day': {'0.0': -21.929519141294918, '0.01': -21.66960396432886, '0.05': -16.91044478094546, '1.0': 28.41542198209261}, '2 day': {'0.0': -40.54427957952835, '0.01': -30.545475985996195, '0.05': -24.168520816340738, '1.0': 51.088310817900684}, '5 day': {'0.0': -55.75711582516863, '0.01': -51.67402434907517, '0.05': -41.000739068994434, '1.0': 72.32310272412789}, '10 day': {'0.0': -62.44996926311055, '0.01': -60.13274484900863, '0.05': -55.59139381547459, '1.0': 92.19783672159627}, '12 days': {'0.0': -62.4380996705744, '0.01': -60.9266040423165, '0.05': -53.5404433613126, '1.0': 98.31750902472476}}, '2022-02-12': {'1 day': {'0.0': -22.516091428609652, '0.01': -22.249224022601158, '0.05': -17.36276652182623, '1.0': 29.17547964499243}, '2 day': {'0.0': -41.628760760226406, '0.01': -31.36250847999575, '0.05': -24.814982074561364, '1.0': 52.45482447186732}, '5 day': {'0.0': -57.24851099680533, '0.01': -53.056204708886035, '0.05': -42.09742965953306, '1.0': 74.2576060535103}, '10 day': {'0.0': -64.12038533914836, '0.01': -61.74117964693251, '0.05': -57.07835624338999, '1.0': 94.66395080384349}, '12 days': {'0.0': -64.1081982579341, '0.01': -62.5562730405812, '0.05': -54.97254682532114, '1.0': 100.94731252292925}}, '2022-02-11': {'1 day': {'0.0': -22.90625945963707, '0.01': -22.634767666190914, '0.05': -17.66363563352303, '1.0': 29.681044275668214}, '2 day': {'0.0': -42.35012093374618, '0.01': -31.905970839816, '0.05': -25.244986221893527, '1.0': 53.36378310027617}, '5 day': {
            '0.0': -58.24053658373707, '0.01': -53.9755842997306, '0.05': -42.82691111921061, '1.0': 75.54437218850182}, '10 day': {'0.0': -65.23148957212844, '0.01': -62.81105603167418, '0.05': -58.067433319239306, '1.0': 96.30432641750268}, '12 days': {'0.0': -65.21909130819199, '0.01': -63.6402736966473, '0.05': -55.92513357526411, '1.0': 102.6965687954693}}, '2022-02-10': {'1 day': {'0.0': -24.372064449845283, '0.01': -24.08319950010815, '0.05': -18.793957469895346, '1.0': 31.580377638696255}, '2 day': {'0.0': -45.060167011325625, '0.01': -33.94768050248918, '0.05': -26.860449752593247, '1.0': 56.77860950188076}, '5 day': {'0.0': -61.96743356171264, '0.01': -57.42956075343146, '0.05': -45.567467696959994, '1.0': 80.37856687363472}, '10 day': {'0.0': -69.40574783991879, '0.01': -66.83042722292909, '0.05': -61.783253166556804, '1.0': 102.46698088713178}, '12 days': {'0.0': -69.39255619296928, '0.01': -67.71270773709539, '0.05': -59.5038645338098, '1.0': 109.2682721887236}}, '2022-02-09': {'1 day': {'0.0': -26.32716979537433, '0.01': -26.015132356145006, '0.05': -20.30159203194293, '1.0': 34.11372746067381}, '2 day': {'0.0': -48.67485355441958, '0.01': -36.67093325587463, '0.05': -29.015171155151442, '1.0': 61.333339084894725}, '5 day': {'0.0': -66.93840599839473, '0.01': -62.036509067206, '0.05': -49.222849450109514, '1.0': 86.82646405870904}, '10 day': {'0.0': -74.97341523598658, '0.01': -72.19150468833716, '0.05': -66.7394508156598, '1.0': 110.68679100969716}, '12 days': {'0.0': -74.959165366845, '0.01': -73.14456096107952, '0.05': -64.27721165297132, '1.0': 118.03367585374846}}, '2022-02-08': {'1 day': {'0.0': -25.56676601832562, '0.01': -25.26374111060708, '0.05': -19.715224132120145, '1.0': 33.12842568262761}, '2 day': {'0.0': -47.26898491081868, '0.01': -35.611772078566176, '0.05': -28.17713022976612, '1.0': 59.56185726358033}, '5 day': {'0.0': -65.00503385294891, '0.01': -60.24471769060659, '0.05': -47.80115312156836, '1.0': 84.318668054384}, '10 day': {'0.0': -72.80796909928478, '0.01': -70.10640806524756, '0.05': -64.81182506352516, '1.0': 107.48984068775397}, '12 days': {'0.0': -72.79413080701994, '0.01': -71.03193735369327, '0.05': -62.42070239280517, '1.0': 114.62452653630444}}, '2022-02-07': {'1 day': {'0.0': -25.186909182576375, '0.01': -24.88838645094521, '0.05': -19.422306261727527, '1.0': 32.63622189963303}, '2 day': {'0.0': -46.566688538081024, '0.01': -35.08267211154292, '0.05': -27.758490049701834, '1.0': 58.67692020837065}, '5 day': {'0.0': -64.0392250975727, '0.01': -59.34963507373759, '0.05': -47.09095008857979, '1.0': 83.06590802917113}, '10 day': {'0.0': -71.7262286578242, '0.01': -69.0648059199343, '0.05': -63.84888689723078, '1.0': 105.89281622523202}, '12 days': {'0.0': -71.71259596723412, '0.01': -69.9765842073089, '0.05': -61.49329020155733, '1.0': 112.92149886678507}}, '2022-02-06': {'1 day': {'0.0': -23.884619954672644, '0.01': -23.601532341930803, '0.05': -18.418075848128694, '1.0': 30.94876593148393}, '2 day': {'0.0': -44.158957743377464, '0.01': -33.26872242657933, '0.05': -26.32323722401543, '1.0': 55.643029842545644}, '5 day': {'0.0': -60.72807673858456, '0.01': -56.28096198343189, '0.05': -44.656112348563106, '1.0': 78.77098496226046}, '10 day': {'0.0': -68.01762375270698, '0.01': -65.49380988684375, '0.05': -60.54757997556101, '1.0': 100.41762778972893}, '12 days': {'0.0': -68.00469594043184, '0.01': -66.35844467466161, '0.05': -58.31377941532538, '1.0': 107.08289237057048}}, '2022-02-05': {'1 day': {'0.0': -23.504419729177997, '0.01': -23.225838362480822, '0.05': -18.124893180624447, '1.0': 30.456117197350345}, '2 day': {'0.0': -43.456026496261, '0.01': -32.73914415434771, '0.05': -25.904218594147643, '1.0': 54.75729280618127}, '5 day': {'0.0': -59.761394894214284, '0.01': -55.38507021384271, '0.05': -43.945267293592224, '1.0': 77.51709244473568}, '10 day': {'0.0': -66.93490542026268, '0.01': -64.45126613547833, '0.05': -59.58377131527877, '1.0': 98.81915962059972}, '12 days': {'0.0': -66.92218339552576, '0.01': -65.30213749135034, '0.05': -57.38552884549312, '1.0': 105.37832516777749}}}},
    },
}


@credmark.model.describe(slug='finance.var-regtest',
                         version='1.0',
                         display_name='Value at Risk - Regression Test',
                         description='Value at Risk - Regression Test',
                         input=EmptyInput,
                         output=None)
class ValueAtRiskRegressionTest(credmark.model.Model):
    def compare_dict(self, key_path, dict_a, dict_b):
        for k_a, v in dict_a.items():
            if k_a in dict_b:
                k_b = k_a
            else:
                k_b = str(k_a)
                assert k_b in dict_b
            new_key_path = key_path + [k_b]
            try:
                if isinstance(v, dict):
                    assert self.compare_dict(new_key_path, v, dict_b[k_b])
                elif isinstance(v, str):
                    assert v == dict_b[k_b]
                elif isinstance(v, float):
                    assert np.isclose(v, dict_b[k_b])
                else:
                    raise ModelRunError('')
            except:  # AssertionError as _err:
                print(f'Unequal value {dict_a[k_a]} != {dict_b[k_b]} at {new_key_path}')
                raise
        return True

    def run(self, input: EmptyInput) -> None:
        for case_name, case_detail in TEST_CASE.items():
            self.logger.info(f'Testing {case_name}')
            res = self.context.run_model('finance.var', input=case_detail['input'])
            self.logger.info(res)
            try:
                assert self.compare_dict([], res, case_detail['output'])
            except:
                self.logger.error(f'Failed testing {case_name}')
                raise
